<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../../Scripts/angular.js"></script>
    <script>

        (function () {

            angular.module('fupApp', [])
                .directive('ngFiles', ['$parse', function ($parse) {

                    function fn_link(scope, element, attrs) {
                        var onChange = $parse(attrs.ngFiles);
                        element.on('change', function (event) {
                            onChange(scope, { $files: event.target.files });
                        });
                    };

                    return {
                        link: fn_link
                    }
                }])
                .controller('fupController', function ($scope, $http) {

                    var formdata = new FormData();
                    $scope.getTheFiles = function ($files) {
                        angular.forEach($files, function (value, key) {
                            formdata.append(key, value);
                        });
                    };

                    $scope.uploadFiles = function () {

                        var request = {
                            method: 'POST',
                            url: '/api/fileupload',
                            data: formdata,
                            headers: {
                                'Content-Type': undefined
                            }
                        };

                        $http(request)
                            .then(function (d) {
                                alert(d.data);
                            }, function (err) {
                                alert(err);
                            });


                    }
                });

        })();
    </script>
</head>
<body ng-app="fupApp">
    <div ng-controller="fupController">
        <input type="file" id="file1" name="file" multiple
               ng-files="getTheFiles($files)" />

        <input type="button" ng-click="uploadFiles()" value="Upload" />
    </div>
</body>
</html>
